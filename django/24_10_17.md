# DRF with N:1 Relation
## Comment 모델 정의

### Comment 클래스 정의 및 데이터베이스 초기화
  
  ```python
  # articles/models.py
  
  class Comment(models.Model):
    article = models.ForeignKey(Article, on_delete=models.CASCADE)
    content = models.TextField()
    create_at = modelsDateTimeField(auto_now_add=True)
    update_at = modelsDateTimeField(auto_now=True)
  ```

  ### migrate 및 fixtures 데이터 로드
  ```
  $ python manage.py makemigrations
  $ python manage.py migrate
  $ python manage.py loaddata articles.json comments.json
  ```
  ### URL 및 HTTP request method 구성

  |               | `GET`   | `POST` | `PUT`   | `DELETE` |
  | ------------- | ------- | ------ | ------- | -------- |
  | `comment/`   | 댓글 목록 조회 |         |         |          |
  | `comment/1/` | 단일 댓글 조회 |         | 단일 댓글 수정 | 단일 댓글 삭제  |
  | `articles/1/comments/1/` |         | 댓글 생성 |         |         |

  ### Get method - List

    1. 댓글 목록 조회를 위한 CommentSerializer정의

    ```python
    # articles/serializers.py

    from .model import Aeticle,Comment


    class CommentSerializer(serializers.ModelSerializer):
      class Meta:
        model = Comment
        fields = '__all__'
    ```

    2. url 작성

    ```python
    urlpatterns = [
      ...,
      path('comments/',views.comment_list),
    ]
    ```

    3. view 작성

    ```python
    from .models import Article, Comment
    from .serializers import ArticleListSerializer, ArticleSerializer, CommentSerializer

    @api_view(['GET'])
    def article_list(request):
      if request.method == 'GET':
        articles = Article.objects.all()
        serializer = ArticleListSerializer(articles, many=True)
        return Response(serializer.data)
      
    ```

    - GET 응답 확인 : http://127.0.01:8000/api/v1/comments/

  ### Get method - Detail

    1. 단일 댓글 조회를 위한 url 및 view 함수작성

    ``` python
      path('comments/<int:comment_pk>/', views.comment_detail),
    ```

    ```python
    @api_view(['GET'])
    def comment_detail(request, comment_pk):
      comment = Comments.objects.get(pk=comment_pk)
      serializer = CommentSerializer(comment)
      return Response(serializer.data)
    ```
    
    - GET 응답 확인 : http://127.0.01:8000/api/v1/comments/1/
  
  ### POST method

    1. 단일 댓글 생성을 위한 url 및 view 함수 생성

      ![스크린샷 2024-10-16 232728](https://github.com/user-attachments/assets/906cd260-80fb-4b05-91bc-8906e20c3b07)

    2. serializer 인스턴스의 save()메서드는 특정 Serializer 인스턴스를 저장하는 과정에서 추가 데이터를 받을 수 있음

      ![스크린샷 2024-10-16 232735](https://github.com/user-attachments/assets/4c03d9b6-60f3-4811-a4ce-f756fa710433)


    - GET 응답 확인 : http://127.0.01:8000/api/v1/articles/1/comments/
    - 상태코드 400 응답 확인
    - CommentSerializer에서 외래 키에 해당하는 article field 또한 사용자로부터 입력 받도록 설정되어 있기 때문에 서버 측에서는 누락되었다고 판단한 것
    - 유효성 검사 목록에서 제외 필요
    - article field를 읽기 전용 필드로 설정하기

  ### 읽기 전용 필드 (read_only_fields)

  - 데이터를 전송 받은 시점에 "유효성 검사에서 제외시키고, 데이터 조회 시에는 출력"하는 필드 

  ![스크린샷 2024-10-16 235046](https://github.com/user-attachments/assets/25c10ee0-29c2-4957-acbd-b25989cc32d1)

  - POST : http://127.0.01:8000/api/v1/articles/1/comments/ 재요청

  ### DELETE & PUT method

  1. 단일 댓글 삭제 및 수정을 위한 view 함수 작성

  ![스크린샷 2024-10-16 235231](https://github.com/user-attachments/assets/59d96d06-8bd2-42bc-838c-e3ab7ca74cef)

  - DELETE : http://127.0.01:8000/api/v1/comments/21/ 응답 확인
  - PUT    : http://127.0.01:8000/api/v1/comments/1/ 응답 확인

## 응답 데이터 재구성
  ### 댓글 조회 시 게시글 출력 내역 변경
  1. 댓글 조회시 게시글 번호만 제공해주는 것이 아닌 '게시글의 제목'까지 제공하기

  ![스크린샷 2024-10-16 235518](https://github.com/user-attachments/assets/a962ef32-a990-4f78-8d59-e6a91db1e1c4)

  2. 필요한 데이터를 만들기 위한 Serializer는 내부에서 추가 선언이 가능

  ![스크린샷 2024-10-16 235602](https://github.com/user-attachments/assets/f0abfc0a-f236-4427-8577-4f9d4d9e88a5)

  - GET    : http://127.0.01:8000/api/v1/comments/1/ 응답 확인

## 역참조 데이터 구성